/*eslint-disable no-console*/

import { saveDealAsync } from "./importDataFeed";

async function importDataFeed() {
    //const csv = `aw_deep_link,product_name,aw_product_id,merchant_product_id,merchant_image_url,description,merchant_category,search_price,merchant_name,merchant_id,category_name,category_id,aw_image_url,currency,store_price,delivery_cost,merchant_deep_link,language,last_updated,display_price,data_feed_id,Telcos:contract_type,Telcos:term,Telcos:initial_cost,Telcos:month_cost,Telcos:gift,Telcos:inc_minutes,Telcos:inc_data,Telcos:connectivity,Telcos:inc_texts,Telcos:tariff,Telcos:storage_size,Telcos:special_offer,Telcos:network,Telcos:operating_system,Telcos:device_product_json,Telcos:device_product_version_json,Telcos:device_product_edition_json,Telcos:device_full_name,Telcos:device_description,Telcos:device_images_json,Telcos:device_features_json,Telcos:device_specifications_json,Telcos:network_details_json,Telcos:tariff_group_details_json,Telcos:tariff_details_json,Telcos:tariff_allowances_json,Telcos:tariff_out_of_plan_charges_json,Telcos:deal_tags_json,Telcos:deal_type_json,Telcos:deal_promo_info,Telcos:deal_retailer_json,Telcos:deal_cost_json,Telcos:deal_discounts_json,Telcos:deal_cashback_json,Telcos:deal_legal_info,Telcos:subscription_name,Telcos:subscription_price_effective,Telcos:subscription_renewal
    //http://www.awin1.com/pclick.php?p=13304516721&a=218297&m=3235,"Samsung Galaxy S6 Edge (32GB Black Sapphire Refurbished) at £129.99 on O2 Refresh (24 Month(s) contract) with UNLIMITED mins; UNLIMITED texts; 3000MB of 4G data. £30.00 a month.",13304516721,42861686,http://media.bigupdata.co.uk/img_product_image_main_large400x400_product_edition0000001253.png?h=400&w=400&auto=enhance&auto=format&bg=FFFFFF&trim=color&trimcolor=FFFFFF&trim=auto&trimtol=2,"The 4G ready Galaxy S6 Edge has all the iconic design you'd expect from Samsung, with a fresh new twist. The full metal-and-glass chassis creates a sleek modern look that feels truly premium.The new, contoured shape comes in a range of colours including Black Sapphire, White Pearl, Gold Platinum and Green Emerald. Dust and water resistant, the S6 Edge is made to last. With an IP67 certification, the S6 Edge is resistant to sweat, rain, liquids, sand and dust so your phone is protected whilst you enjoy your favourite sporting activities. Packed with an impressive 16 megapixel camera with selective auto focus and advanced High Dynamic Range for beautifully lit shots even in low light conditions.","Mobile Phone",129.99,"O2 Mobiles",3235,"Mobile Phones",348,http://images2.productserve.com/?w=200&h=200&bg=white&trim=5&t=letterbox&url=media.bigupdata.co.uk%2Fimg_product_image_main_large400x400_product_edition0000001253.png%3Fh%3D400%26w%3D400%26auto%3Denhance%26auto%3Dformat%26bg%3DFFFFFF%26trim%3Dcolor%26trimcolor%3DFFFFFF%26trim%3Dauto%26trimtol%3D2&feedId=11643&k=750b1fc93ec7d17ef1aa918e2432c703db62a548,GBP,129.99,,https://www.o2.co.uk/shop/fusepump/add/product/?device=11f63bd3-0e73-4224-b77a-10cb26cb7264&plan=6718bcaf-b9c0-4aa0-96ce-e6b29a9966f0&dataallowance=&oneOff=129.99&monthly=8.00,en,"2017-09-25 11:41:00",GBP129.99,11643,"Phone Contract",24,129.99,30.00,,UNLIMITED,3000,4G,UNLIMITED,"O2 Refresh",32GB,,O2,Android,"{""product_id"":""13"",""product_name"":""Galaxy"",""product_brand"":""Samsung"",""product_brand_id"":""28"",""product_type"":""Mobile Phone"",""product_type_id"":""1""}","{""product_version_id"":""624"",""product_version_name"":""S6 Edge""}","{""product_edition_id"":""1253"",""product_edition_name"":""32GB Black Sapphire"",""reseller_product_edition_id"":""20035""}","Samsung Galaxy S6 Edge (32GB Black Sapphire Refurbished)","The 4G ready Galaxy S6 Edge has all the iconic design you'd expect from Samsung, with a fresh new twist. The full metal-and-glass chassis creates a sleek modern look that feels truly premium.The new, contoured shape comes in a range of colours including Black Sapphire, White Pearl, Gold Platinum and Green Emerald. Dust and water resistant, the S6 Edge is made to last. With an IP67 certification, the S6 Edge is resistant to sweat, rain, liquids, sand and dust so your phone is protected whilst you enjoy your favourite sporting activities. Packed with an impressive 16 megapixel camera with selective auto focus and advanced High Dynamic Range for beautifully lit shots even in low light conditions.","{""primary_thumb"":""http://media.bigupdata.co.uk/img_product_image_main_large400x400_product_edition0000001253.png?h=150&w=150&auto=enhance&auto=format&trim=auto&trimtol=2"",""primary_large"":""http://media.bigupdata.co.uk/img_product_image_main_large400x400_product_edition0000001253.png?h=150&w=150&auto=enhance&auto=format&trim=auto&trimtol=2""}","{""colour"":""Black Sapphire"",""colour_group"":""Black"",""max_data_standard"":""4G"",""condition"":""Refurbished"",""condition_friendly"":"""",""sim_type"":""Nano SIM"",""capacity"":""32GB"",""os"":""Android"",""megapixels"":""16""}","{""display_resolution"":""2560 x 1440"",""display_size"":""5.1\"""",""display_type"":""AMOLED"",""primary_camera_flash"":""LED"",""primary_camera_resolution"":""5312 x 2988"",""internal_memory"":""32GB"",""memory_card_slot"":""None"",""processor"":""1.5 GHz Quad-core & 2.1 GHz Quad-core"",""2g"":""GSM 850/900/1800/1900"",""3g"":""HSDPA 850/900/1900/2100"",""4g"":""LTE"",""bluetooth"":""4.1 with LE, apt-X"",""gps"":""A-GPS, GLONASS and Beidou"",""wifi"":""802.11 a/b/g/n/ac"",""talk_time"":""Up to 26 hours"",""secondary_camera"":""5 Megapixels"",""weight_grams"":""132"",""dimensions"":""142.1 x 70.1 x 7 mm"",""chipset"":""Exynos 7420"",""battery_type"":""Non-removable"",""ip_rating"":""Not rated""}","{""name"":""O2"",""company_id"":""21"",""logo_url"":""http://media.bigupdata.co.uk/img_company_logo_thumbnail150x150_company0000000021.png"",""coverage_url"":""http://www.o2.co.uk/coveragechecker"",""terms_url"":""http://www.o2.co.uk/termsandconditions"",""description"":""O2 is the commercial brand of Telefónica UK Limited and is a leading digital communications company with the highest customer satisfaction for any mobile provider according to Ofcom. With over 23 million customers, O2 runs 2G, 3G and 4G networks across the UK, as well as operating O2 Wifi. O2 has average download speeds of10.4 Mbps and 98% network reliability.""}","{""tariff_group_id"":""423"",""tariff_group_description"":""Get your hands on the latest phone by upgrading early with O2 refresh plans. Trade in your old phone any time for money off the latest model."",""tariff_group_promo_info"":""""}","{""tariff_id"":""1722"",""tariff_name"":""O2 Refresh"",""tariff_type_id"":""4"",""tariff_type"":""Phone Contract"",""tariff_term"":""24"",""tariff_term_friendly"":""24 Month(s)"",""tariff_promo_info"":""""}","{""mins_details"":{""cross_net_anytime"":""UNLIMITED"",""cross_net_anytime_qualifier"":""See Terms"",""same_net_anytime"":"""",""special_numbers_see_terms"":"""",""landline"":""""},""texts_details"":{""cross_net_anytime"":""UNLIMITED"",""same_net_anytime"":""""},""data_details"":{""wifi_mb"":"""",""cellular_mb"":""3000"",""cellular_speed"":""4G""}}","{""pence_per_cross_net_min"":""55"",""pence_per_cross_net_text"":""15"",""pence_per_mb"":""3"",""data_charge_text"":"""",""pence_per_voicemail_min"":""35""}",,"{""deal_type_id"":""0"",""deal_type_name"":""Consumer""}",,"{""name"":""O2"",""company_id"":""21"",""logo_url"":""http://media.bigupdata.co.uk/img_company_logo_thumbnail150x150_company0000000021.png"",""terms_url"":""http://www.o2.co.uk/termsandconditions""}","{""upfront_inc_vat"":""129.99"",""upfront_exc_vat"":""108.33"",""upfront_previous_inc_vat"":"""",""upfront_previous_exc_vat"":"""",""monthly_total_inc_vat"":""30.00"",""monthly_total_exc_vat"":""25.00"",""monthly_total_previous_inc_vat"":"""",""monthly_total_previous_exc_vat"":"""",""monthly_device_inc_vat"":""8.00"",""monthly_device_exc_vat"":""6.67"",""monthly_device_term_months"":""24"",""monthly_device_final_term_inc_vat"":"""",""monthly_device_final_term_exc_vat"":"""",""monthly_device_final_term_months"":"""",""monthly_contract_inc_vat"":""22.00"",""monthly_contract_exc_vat"":""18.33"",""monthly_contract_term_months"":""24"",""ecpm_inc_vat"":""35.42"",""ecpm_exc_vat"":""29.51"",""tco_inc_vat"":""849.99"",""tco_exc_vat"":""708.32""}",,,"From 2015, Airtime Plan prices will be adjusted on your April bill by RPI rate of inflation announced in the preceding February. Phone Plan on 0% APR Representative, 24 month consumer credit agreement, subject to status and credit check. 18+",,,`;

    const csv = `aw_deep_link,Telcos:network_details_json
    http://www.awin1.com/pclick.php?p=13304516721&a=218297&m=3235,"{""name"":""O2"",""company_id"":""21"",""logo_url"":""http://media.bigupdata.co.uk/img_company_logo_thumbnail150x150_company0000000021.png"",""coverage_url"":""http://www.o2.co.uk/coveragechecker"",""terms_url"":""http://www.o2.co.uk/termsandconditions"",""description"":""O2 is the commercial brand of Telefónica UK Limited and is a leading digital communications company with the highest customer satisfaction for any mobile provider according to Ofcom. With over 23 million customers, O2 runs 2G, 3G and 4G networks across the UK, as well as operating O2 Wifi. O2 has average download speeds of10.4 Mbps and 98% network reliability.""}"`;

    const lines = csv.split("\n");
    let lineNr = 0;
    let header = "";
    let dealCsv = "";
    lines.forEach(
        line => {
            const isheaderRow = lineNr === 0 && line.includes("aw_deep_link");
            if (isheaderRow) {
                header = line;
                dealCsv = header;
            } else {
                dealCsv += "\n" + line;
                saveDealAsync(dealCsv);
                dealCsv = header;
            }
            lineNr += 1;
        });
}

export default importDataFeed;